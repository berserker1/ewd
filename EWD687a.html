<html>
<head>
  <title>Termination detection for diffusing computations (EWD687a)</title>
  <link href="https://fonts.googleapis.com/css?family=Lobster|Raleway" rel="stylesheet">
  <link href="assets/transcriptions.css" rel="stylesheet">
  <meta name="generator" content="convertArticle.pl">
</head>
<body>
<div class="metabar">
  <a href="index.html">HOME</a>
</div>
<h1>Termination detection for diffusing computations (EWD687a)</h1>
<div class='body'>				<center><u>Termination detection for diffusing computations</u><br>by<br>Edsger W. Dijkstra and C. S. Scholten<br></center>				<p class="noindent"><u>Abstract</u>. The activity of a finite computation may propagate over a network of machines, when machines may delegate (repeatedly) subtasks to their neighbors; when such a computation is fired from a single machine, we call it &quot;a diffusing computation&quot;. We present a signalling scheme &#x2014;to be superimposed on the diffusing computation&#x2014; enabling the machine that fired it to detect its termination. Our signalling scheme is perfectly general in the sense that, independent of the topology of the network, it is applicable to any diffusing computation.</p>				<p class="noindent">Authors' addresses:</p>				<table>					<tr valign="top">						<td>Edsger W.Dijkstra</td>						<td>Burroughs<br>							Plataanstraat 5<br>							5671 AL NUENEN, The Netherlands</td>					</tr>					<tr valign="top">						<td>C.S.Scholten</td>						<td>Philips Research Laboratories<br>							5656 AA EINDHOVEN, The Netherlands</td>					</tr>				</table>				<p class="noindent">26th of January 1979.</p>				<p class="noindent"></p>				<hr>				<p class="noindent"></p>				<center><u>Termination detection for diffusing computations</u><br>by<br>Edsger W. Dijkstra and C. S. Scholten<br></center>				<p>The following seems to capture the quintessence of a situation that is not unusual in distributed processing. Consider a finite, directed graph. If the graph contains an edge from node <var>A</var> to node <var>B</var>, we call <var>B</var> &quot;a successor of <var>A</var>&quot; and <var>A</var> &quot;a predecessor of <var>B</var>&quot;. We assume the existence of a node without incoming edges; this node will be called &quot;the environment&quot; (because it acts as such with respect to the rest of the graph). The other nodes will be called &quot;the internal nodes&quot;.</p>				<p> For each node its initial state will be called "the neutralstate".  A so-called "diffusing computation" is started when theenvironment sends &#x2014;of its own accord, so to speak&#x2014; a message to one or more of its successors; it is supposed to do this just once. After reception of its first message, an internal node is free to send messages to its successors. It is this feature that inspired the name &quot;diffusing computation&quot;.</p><p> We shall confine our attention to diffusing computations for whichit can be proved that also each internal node will send only a finitenumber of messages.  For such a computation eventually each node willreach the situation in which it neither sends nor receives any moremessages; when all nodes have reached that state, the whole graph isas dead as a doornail and the diffusing computation is defined to haveterminated. </p><p>Our problem is the design of a signalling scheme &#x2014;to be superimposed on the diffusing computation proper&#x2014; such that, when the diffusing computation proper has thus terminated, the fact of this completion will eventually be signalled back to the environment. Besides a node's ability to receive messages from its predecessors and to send messages to its successors, we assume each node also to be able to receive &quot;signals&quot; from its successors and to send &quot;signals&quot; to its predecessors; in other words, each edge is assumed to be able to accommodate two-way traffic, but only messages of the computation proper in the one direction and signals in the opposite direction. We shall impose that in the total computation &#x2014;i.e., from the moment that the environment sent its message to the rest of the graph until it has received the completion signal&#x2014; each edge will carry as many messages in the one direction as it has carried signals in the opposite direction.</p>				<p> For each edge we define the "deficit" as the number of messagestransmitted along it minus the number of signals returned along it;because no node is supposed to be equipped with the clairvoyance thatit would need to predict how many more messages of the computationproper it is going to receive, we impose, to begin with, the invariant</p>				<p></p>				<table width="100%" border="0" cellspacing="2" cellpadding="0">					<tr>						<td align="left" valign="top" width="5%">P0:</td>						<td>each edge has a non-negative deficit,</td>					</tr>				</table>				<p class="noindent">a relation which is obviously satisfied initially.</p>				<p> The obligation to keep P0 invariant does not constrain the sendingof messages; a signal, however, may only be sent by a node with atleast one incoming edge that has a positive deficit. </p>				<p> For each node we define </p>				<p class="noindent"><var>C</var> = the sum of the deficits of its incoming edges, </p>				<p class="noindent">and relation P0 will be kept invariant by keeping </p>				<p></p>				<table width="100%" border="0" cellspacing="2" cellpadding="0">					<tr>						<td align="left" valign="top" width="5%">P1:</td>						<td><var>C</var> &#x2265; 0</td>					</tr>				</table>				<p class="noindent">invariant for each node, complemented by the understanding &#x2014;seelater&#x2014; that a node sending a signal will select for it an incoming edge with an initially positive deficit. (This selection is possible: because sending a signal implies for its sender <var>C</var>:=<var>C</var>-1, the invariance of P1 implies the initial validity of <var>C</var> &#x2265; 1, i.e. the existence of at least one such incoming edge.)</p>				<p> Similarly we define for each node </p>				<p class="noindent"><var>D</var> = the sum of the deficits of its outgoing edges. </p>				<p class="noindent">From P0 we conclude that for each node </p>				<p class="noindent"></p>				<table width="100%" border="0" cellspacing="2" cellpadding="0">					<tr>						<td align="left" valign="top" width="5%">P2:</td>						<td><var>D</var> &#x2265; 0. </td>					</tr>				</table>				<p class="noindent">For the sequel we redefine &quot;neutral state&quot; to mean any state with <var>C</var>=0 <b>and</b> <var>D</var>=0 (which holds initially).</p>				<p> In our proposal the sending of messages and signals is furtherconstrained by the required invariance of </p>				<p></p>				<table width="100%" border="0" cellspacing="2" cellpadding="0">					<tr>						<td align="left" valign="top" width="5%">P3:</td>						<td><var>C</var>&gt;0 <b>or</b> <var>D</var>=0</td>					</tr>				</table>				<p class="noindent">for each internal node. (We further postulate that no node is infinitely lazy.) Because the sending of a message implies <var>D</var>:=<var>D</var>+1 for its sender, the invariance of P3 excludes spontaneous message sending by an internal node in its neutral state; furthermore the invariance of P3 may prevent an internal node from reducing its <var>C</var> to zero, i.e. from sending the last signal currently due to its predecessors.</p>				<p>We observe that it suffices when each sending internal node keeps P3 invariant for <em>itself</em>, because</p>				<p class="noindent">1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the sending of a message then keeps P3 invariant for <em>all</em> internal nodes: for the sending node by virtue of its construction, for the receiving successor by virtue of the fact that its <var>C</var> is increased by 1, and for all other nodes because their <var>C'</var>s and <var>D'</var>s remain unaffected, and </p>				<p class="noindent">2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the sending of a signal then keeps P3 invariant for <em>all</em> internal nodes: for the sending node by virtue of its construction, for the receiving predecessor by virtue of the fact that the accompanying decrease of its <var>D</var> by 1 can never destroy the truth of <var>D</var>=0 on account of P2, and for all other nodes because their <var>C'</var>s and <var>D'</var>s remain unchanged.</p>				<center><p class="noindent">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>*</p></center>				<p>A node in such a state of the computation proper that it has messages to send should maintain <var>C</var>&gt;0; otherwise, because the sending of a signal includes for its sender <var>C</var>:=<var>C</var>-1, the invariance of P1 <b>and</b> P3 requires by the axiom of assignment that the act of signalling be guarded by</p>				<p></p>				<table width="100%" border="0" cellspacing="2" cellpadding="0">					<tr>						<td align="left" valign="top" width="5%">G:</td>						<td> (<var>C</var>-1 &#x2265; 0) <b>and</b> (<var>C</var>-1&gt;0 <b>or</b><var> D</var>=0)</td>					</tr>				</table>				 				<p class="noindent">which is equivalent to </p>				<p class="noindent"></p>				<table width="100%" border="0" cellspacing="2" cellpadding="0">					<tr>						<td align="left" valign="top" width="5%">G:</td>						<td><var>C</var>&gt;1 <u>or</u> (<var>C</var>=1 <b>and</b> <var>D</var>=0). </td>					</tr>				</table>				<p>When the computation proper has terminated, no <var>C</var> is increased anymore; the ensuing signal, as guarded in each internal node by G, will terminate because each sending of a signal decreases the sum of all the <var>C</var>'s over the graph, a sum that is bounded from below on account of P1. Hence, when the computation proper has terminated, the system will reach the &quot;ultimate state&quot; in which neither messages nor signals are sent anymore. From the fact that no more signals are sent we conclude that in the ultimate state <b>non</b> G holds for each internal node, which under the truth of P1 and P2 reduces to</p>				<p><var>C</var>=0 <b>or</b> (<var>C</var>=1 <b>and</b> <var>D</var>&gt;0).</p>				<p class="noindent">For the environment, which has no predecessors, we always have </p>				<p><var>C</var>=0 <b>and</b> <var>D</var> &#x2265; 0 . </p>				<p class="noindent">Hence, in the ultimate state we have </p>				<p><var>C</var> &#x2264 <var>D</var></p>				<p class="noindent">for all nodes. Because the sum of the <var>C'</var>s over the whole graph equals the sum of the <var>D'</var>s over the whole graph, we have in the ultimate state</p>				<p><var>C</var>=<var>D</var></p>				<p class="noindent">for all nodes. Because the environment always has <var>C</var>=0, we conclude our </p>				<p class="noindent"><b><u>Theorem 1</u></b>.  A bounded number of steps after the diffusingcomputation has terminated, the environment will have returned to theneutral state. </p>				<center><p class="noindent">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>*</p></center>				<p> The above theorem tells us that after termination of the diffusingcomputation the moment will come that the environment has returned tothe neutral state.  Conversely we would like to conclude from the factthat the environment has returned to the neutral state that, indeed,the diffusing computation has terminated.  Calling a node that is notin its neutral state &#x2014;i.e. a node with <var>C</var>&gt;0 <b>or</b> <var>D</var>&gt;0&#x2014; "anengaged node", we propose </p>				<p></p>				<table width="100%" border="0" cellspacing="2" cellpadding="0">					<tr>						<td align="left" valign="top" width="5%">P4:</td>						<td>all engaged internal nodes are reachable from the environment via directed paths, all edges of which have positive deficits,</td>					</tr>				</table>				<p class="noindent"> because under the truth of P4, a neutral environment &#x2014;which has nooutgoing edges with a positive deficit!&#x2014; implies that all internalnodes are in the neutral state as well and, therefore, the diffusingcomputation has terminated (by definition, as, on account of P3, nointernal node will then send anymore messages). </p>				<p> Up till now, a node allowed to send a signal was constrained inits selection of predecessors to receive the signal only by therequirement that on all its incoming edges the deficit should remainnon-negative.  In the following we shall show how, by furtherrestriction of the selection of predecessor to receive the signal, theinvariance of P4 can be maintained. </p>				<p>Up till now each node's signalling obligation can be characterized by a bag, such that the deficit of the edge from <var>A</var> to <var>B</var> equals the number of occurrences of the name of <var>A</var> in the bag of <var>B</var>. A node in the neutral state has an empty bag, each reception by <var>B</var> of a message from <var>A</var> causes the name of <var>A</var> to be added to <var>B'</var>s bag, which by this mechanism can be filled with names of predecessors of <var>B</var>, and the transmission of a signal from <var>B</var> to its predecessor <var>A</var> is accompanied by the removal of one occurrence of <var>A'</var>s name from <var>B'</var>s bag (in which the name of <var>A</var> could occur several times). Note that for each node, <var>C</var> equals the number of elements in its bag.</p>				<p> We can ensure P4 by replacing each bag by what we have dubbed "acornet".  The name "cornet" has been chosen because, like in a pointedbag, one element contained in it enjoys the special status of being"the oldest element": whereas a stack is characterized by "last in,first out", a cornet is characterized by the much weaker "very firstin, very last out". </p>				<p>Let &quot;the edge from <var>A</var> to <var>B</var> is an engagement edge&quot; mean &quot;the name of <var>A</var> is the oldest element in <var>B'</var>s cornet&quot;. We observe: </p>				<p class="noindent">a) each engagement edge connects two engaged nodes (because it has a positive deficit and, hence, leads from a node with <var>D</var>&gt;0 to a node with <var>C</var>&gt;0) </p>				<p class="noindent">b) engagement edges don't form cycles (because, when the edge from <var>A</var> to <var>B</var> became an engagement edge, <var>B</var> was initially neutral and, hence, had no outgoing engagement edge) </p>				<p class="noindent">c) each engaged internal node has one incoming engagement edge (on account of P3 and because its bag has been replaced by a cornet).</p>				<p> From a), b), and c) we conclude that the engagement edges form arooted tree &#x2014;with the environment as its root&#x2014; to which each engagednode, but no neutral node belongs.  Hence its edges provide the pathswhose existence implies the truth of P4, and for our system withcornets instead of bags we have proved </p>				<p class="noindent"><b><u>Theorem 2</u></b>. When the environment has returned to the neutral state, the diffusing computation has terminated.</p>				<p> This concludes the description and correctness proof of oursignalling scheme. </p>				<p class="noindent"><u>Concluding remarks</u>. </p>				<p>Note that an internal node, while it needs to keep track of the deficits of its incoming edges, does not need to keep a record of to which of its successors it has sent messages, nor from which of its successors it has received signals: for the implementation the counter <var>D</var> suffices.</p>				<p> Note further that our signalling scheme is perfectly general inthe sense that we have made no assumption about the topology of therest of the graph: in particular, neither merging, nor even cyclicpaths have been excluded. </p>				<p>Note further that our signalling scheme is also perfectly general in the sense that it can be superimposed on <em>any</em> diffusing computation fired from a single environment. In particular, because we have not excluded that, in the course of a single diffusing computation, internal nodes switch back and forth between the neutral and the engaged state several times, our highly non-deterministic diffusing computation is &quot;free&quot; to behave like any more specific one (ultimately even like a fully deterministic one). In other words, we can appreciate the study of a single highly non-deterministic algorithm as an effective way of studying a whole class of algorithms: the non-deterministic algorithm emerges when, abstracting from their mutual differences, we concentrate on what the many algorithms of the class have in common.</p>				<p class="noindent"><u>Acknowledgements</u>. We are, foremost of all, indebted to the members of The Tuesday Afternoon Club: in one session an instance of our problem statement was born, in subsequent sessions our successive generalizations were followed closely, and our texts were screened carefully. We are indebted to Dr. P. M. Merlin from the Technion-Israel Institute of Technology, Haifa, who, in a lecture he gave at the University of Newcastle-Upon-Tyne, inspired the problem. We are also grateful to C. A. R. Hoare for his encouragement and for the opportunity he provided &#x2014;by organizing under the auspices of the Science Research Council a Workshop on Distributed Processing&#x2014; for presenting our solution, before this final text was written.</p>				<p class="noindent"></p>			</div>			<div align="left">			<table border="0" cellpadding="0" cellspacing="2" width="459">				<tbody><tr><td valign="top" width="203">Plataanstraat 5<br>NL&#8211;4565 NUENEN<br>The Netherlands</td><td valign="top" width="250">prof.dr.Edsger W.Dijkstra<br>Burroughs Research Fellow</td></tr><tr><td valign="top" width="203">Philips Research Laboratories<br>5656 AA EINDHOVEN<br>The Netherlands</td><td valign="top" width="250">Drs.C.S.Scholten<br>Scientific Adviser</td></tr>			</tbody></table>		</div>			<hr>		<font size="-1">transcribed by Xiaozhou (Steve) Li<br>			<csobj format="MedDate" h="13" region="15" t="DateTime" w="94">Tue, 10 Mar 2009</csobj></font>	</body></html></div>
</body>
</html>
